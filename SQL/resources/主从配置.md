# MySQL 主从配置
##主从配置的原理

MySQL之间数据复制的基础是二进制日志文件（binary log file）。一台MySQL数据库一旦启用二进制日志后，
其作为master，它的数据库中所有操作都会以“事件”的方式记录在二进制日志中，其他数据库作为slave通
过一个I/O线程与主服务器保持通信，并监控master的二进制日志文件的变化，如果发现master二进制日志文
件发生变化，则会把变化复制到自己的中继日志中，然后slave的一个SQL线程会把相关的“事件”执行到自己
的数据库中，以此实现从数据库和主数据库的一致性，也就实现了主从复制。

### 主配置
修改Master节点mysql的my.cnf
```properties

#添加 service-id 是全局唯一的id。不能重复
server-id=a1
#添加默认备份的数据库   不过不设置就默认为备份全部数据库
binlog-do-db=testdb
#忽略开始binlog日志备份的数据库
binlog-ignore-db=mysql
# 读写模式是0 ， 只读模式是1
read-only=0
#开启binlog备份模式，mysql性能会有1%的损耗
log-bin=mysql-bin
#binlog 日志的格式 ，mysql默认采用，如果从服务器要是链式复制，其他服务器也要复制他，则从服务器也要设置该选项
binlog_format =mixed 
#  超过7天的binlog删除
expire_logs_days =7  

```
查看Master上状态状态 记录master现在binlog的写入位置，当前位置是：mysql-bin.000002 的634位置
```sql
/*!  查看主状态   */
show master status\G;
/**
*************************** 1. row ***************************
File: mysql-bin.000002   现在正在写入的binlog文件名
Position: 634            正在写入位置
Binlog_Do_DB: testdb    写入数据库的名称
Binlog_Ignore_DB: mysql
Executed_Gtid_Set:
1 row in set (0.00 sec)
 */
/*!给ip地址为所有（%表示任何ip）MySQL服务器上的admin(密码为liuy) 授权对该master的复制权限*/
grant replication slave on *.* to 'admin'@'%' IDENTIFIED BY 'liuy'; 

```



### Slave服务器的配置

```properties

# 需要复制的数据库名，如果复制多个数据库，重复设置这个选项即可
replicate-do-db =testdb
#不需要复制的数据库名，如果复制多个数据库，重复设置这个选项即可
replicate-ignore-db = mysql-bin
##  链式复制模式A->B->C的时候才使用此设置
#log_slave_updates=1
#默认存储引擎
default-storage-engine = InnoDB
#忽略表大小写 
lower_case_table_names = 1 

```
